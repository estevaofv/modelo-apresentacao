% 
% NExT Beamer Theme
% 
% Autor: Pedro Maione [pedromaionee@gmail.com]
%
% Versão 1.0: 12/04/2017
%

\ProvidesPackage{beamerthemenext}[2017/04/12]

\newif\if@PaginaSecao
\@PaginaSecaofalse
\DeclareOption{nosectionpages}{\@PaginaSecaotrue}
\ProcessOptions

\RequirePackage{eso-pic}
\RequirePackage[brazilian]{babel}
\RequirePackage[T1]{fontenc}
\RequirePackage[utf8x]{inputenc}

\RequirePackage{graphicx}
\RequirePackage{multicol}

\mode<presentation>

% ---------------------------------------------------------------------
% Sumario (Table of Contents)
% ---------------------------------------------------------------------
\useoutertheme[subsection=false,shadow]{miniframes}
\setbeamertemplate{section in toc}[sections numbered]
\setbeamertemplate{subsection in toc}[subsections numbered]

% ---------------------------------------------------------------------
% custom commands
% ---------------------------------------------------------------------
\newcommand{\NExT}{Núcleo de Estudos e Pesquisas Experimentais e Tecnológicas}
\newcommand{\IFG}{Instituto Federal de Educação, Ciência e Tecnologia de Goiás}
\newcommand{\setaDireita}{$\Rightarrow{}$}

% ---------------------------------------------------------------------
% Itemize
% ---------------------------------------------------------------------
\setbeamertemplate{itemize item}{\setaDireita}
\setbeamertemplate{itemize subitem}{\setaDireita}
\setbeamertemplate{itemize subsubitem}{\setaDireita}

\setlength{\parskip}{0.5em}

% ---------------------------------------------------------------------
% Paleta de Cores
% ---------------------------------------------------------------------

\definecolor[named]{nextVermelho}{HTML}{e50000}
\definecolor[named]{nextAzul}{HTML}{086788}
\definecolor[named]{nextLaranja}{HTML}{f18f01}
\definecolor[named]{nextVerde}{HTML}{4cb944}

\definecolor[named]{nextCinzaEscuro}{HTML}{454545}
\definecolor[named]{nextCinza}{HTML}{8b8b8b}
\definecolor[named]{nextCinzaClaro}{HTML}{e7e7e7}

\definecolor[named]{nextVermelhoEscuro}{HTML}{a30000}
\definecolor[named]{nextAzulEscuro}{HTML}{064257}
\definecolor[named]{nextLaranjaEscuro}{HTML}{9a5c01}
\definecolor[named]{nextVerdeEscuro}{HTML}{31762c}

\definecolor[named]{nextVermelhoClaro}{HTML}{ff5c5c}
\definecolor[named]{nextAzulClaro}{HTML}{619eb3}
\definecolor[named]{nextLaranjaClaro}{HTML}{f6b75d}
\definecolor[named]{nextVerdeClaro}{HTML}{8dd288}


% Geral
\setbeamercolor{normal text}{fg=black}
\setbeamercolor{structure}{fg=nextCinza}
\setbeamercolor{alerted text}{fg=nextVermelho}
\setbeamercolor{example text}{fg=white}
\setbeamercolor{copyright text}{fg=nextCinza}
\setbeamercolor{palette primary}{fg=nextCinzaEscuro}
\setbeamercolor{palette secondary}{fg=nextCinzaEscuro,bg=nextCinzaClaro}
\setbeamercolor{palette tertiary}{fg=black,bg=nextCinza}
\setbeamercolor{palette quaternary}{fg=white, bg=nextCinzaEscuro}
% Titlepage
\setbeamercolor{title}{parent=normal text}
\setbeamercolor{subtitle}{parent=normal text}
\setbeamercolor{institute}{parent=normal text}
% Content
\setbeamercolor{frametitle}{parent=palette quaternary}
% Blocks
\setbeamercolor{block title}{parent=palette quaternary}
\setbeamercolor{block body}{parent=palette secondary}
\setbeamercolor{block title example}{fg=white, bg=nextVerdeEscuro}
\setbeamercolor{block body example}{fg=nextCinzaEscuro, bg=nextVerdeClaro}
\setbeamercolor{block title alerted}{fg=white, bg=nextVermelhoEscuro}
\setbeamercolor{block body alerted}{fg=white, bg=nextVermelhoClaro}
% Notes
\setbeamercolor{note page}{fg=nextCinzaEscuro,bg=nextCinza}
\setbeamercolor{note title}{fg=white, bg=nextCinzaEscuro}
\setbeamercolor{note date}{parent=note title}
% Page Number
\setbeamercolor{page number in head/foot}{fg=nextCinzaEscuro}


% Fontes

% Titlepage
\setbeamerfont{title}{size=\fontsize{20}{20}}
\setbeamerfont{subtitle}{size=\fontsize{12}{14}}
\setbeamerfont{date}{size=\fontsize{8}{10}}
\setbeamerfont{author}{size=\fontsize{12}{15}}
\setbeamerfont{institute}{size=\fontsize{8}{10}}
% Section
\setbeamerfont{section title}{size=\LARGE}
% Content
\setbeamerfont{frametitle}{size=\large}
\setbeamerfont{copyright text}{size=\tiny}
\setbeamerfont{block title}{size=\large}
\setbeamerfont{block title example}{size=\large}
\setbeamerfont{block title alerted}{size=\large}
% Captions
\setbeamerfont{caption name}{family=\ttfamily}

% ---------------------------------------------------------------------
% Titlepage
% ---------------------------------------------------------------------

% Estrutura da capa (titlepage)
\def\maketitle{%
  \ifbeamer@inframe%
  \titlepage%
  \else%
  \frame[plain]{%
    \titlepage%
  }%
  \fi%
}%

\def\titlepage{\usebeamertemplate{title page}}

\setbeamertemplate{title page}
{
  % Adiciona o background
  \AddToShipoutPictureFG*{%
    \includegraphics[width=\paperwidth]{background43.pdf}%
  }
  \begin{minipage}[b][\paperheight]{\textwidth}
    \vspace*{10mm}
    % Adiciona o logo do NExT
    \includegraphics[height=15mm]{./logo-next}\par
    \vspace*{10mm}
    \ifx\insertsubtitle\@empty%
    \else%
    % Insere titulo
    {\usebeamerfont{title}\usebeamercolor[fg]{title}\MakeUppercase{\inserttitle}\par}%
    \fi%
    % Insere subtitulo
    \ifx\insertsubtitle\@empty%
    \else%
    {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}%
    \vspace*{10mm}
    \fi%
    % Insere Data
    \ifx\insertdate\@empty%
    \else%
    {\usebeamerfont{date}\usebeamercolor[fg]{date}\insertdate\par}%
    \fi% 
    
    \vfill

    % Insere Autor
    \ifx\insertauthor\@empty%
    \else%
    {\usebeamerfont{author}\usebeamercolor[fg]{author}\insertauthor\par}%
    \fi%
    % Insere Instituto
    \ifx\insertinstitut\@empty%
    \else%
    \vspace*{5mm}
    {\usebeamerfont{institute}\usebeamercolor[fg]{institute}\insertinstitute\par}%
    \fi% 
    \vspace*{10mm}
  \end{minipage}
}

% ---------------------------------------------------------------------
% Sectionpages
% ---------------------------------------------------------------------

% Converte o titulo de seção em caixa alta
\newcommand{\insertsectionHEAD}{%
  \expandafter\insertsectionHEADaux\insertsectionhead}
\newcommand{\insertsectionHEADaux}[3]{\MakeUppercase{#3}
}

\if@PaginaSecao\@empty
\else
% Insert um slide com o titulo da seção
\AtBeginSection[]{%
  \begingroup
  % \setbeamercolor{background canvas}{bg=nextCinzaEscuro}
  \begin{frame}[plain]
    \AddToShipoutPictureFG*{%
    \includegraphics[width=\paperwidth]{background43.pdf}%
  }
    \centering
    \vfill%
    \usebeamerfont{section title}%
    \textcolor{nextVermelhoEscuro}{%
      \insertsectionHEAD%
    }%
    \vfill%
  \end{frame}
  \endgroup
}
\fi

% \if@PaginaSecao\@empty
% \else
% % Insert um slide com o titulo da seção
% \AtBeginSection[]{%
%   \begingroup
%   \setbeamercolor{background canvas}{bg=nextCinzaEscuro}
%   \begin{frame}[plain]
%     \centering
%     \vfill\usebeamerfont{section title}\textcolor{white}{\insertsectionHEAD}\vfill
%   \end{frame}
%   \endgroup
% }
% \fi

% ---------------------------------------------------------------------
% Frametitle
% ---------------------------------------------------------------------
\setbeamertemplate{frametitle}{%
  \begin{beamercolorbox}[%
    wd=\paperwidth,%
    leftskip=0.3cm,%
    rightskip=0.3cm,%
    ht=3ex,%
    dp=1.5ex%
    ]{frametitle}
    \usebeamerfont{frametitle}\MakeUppercase{\insertframetitle}%
  \end{beamercolorbox}
}

% ---------------------------------------------------------------------
% Footline
% ---------------------------------------------------------------------
\usenavigationsymbolstemplate{}
\setbeamertemplate{footline}{%
  \begin{beamercolorbox}[%
    wd=\textwidth,%
    ht=3ex,%
    dp=1.5ex,%
    leftskip=0.3cm,%
    rightskip=0.3cm%
    ]{structure}%
    \hfill\usebeamerfont{page number in head/foot}%
    \insertframenumber%
  \end{beamercolorbox}%
}

% ---------------------------------------------------------------------
% Captions
% ---------------------------------------------------------------------
\setbeamertemplate{caption label separator}{: }

% ---------------------------------------------------------------------
% Blocks
% ---------------------------------------------------------------------
\setbeamertemplate{block begin}
{
  \setbeamercolor{item}{parent=block body}
  \par\vskip\medskipamount%
  \begin{beamercolorbox}[sep=.5ex,%
    dp=0.6ex,%
    leftskip=0.5ex,%
    rightskip=0.5ex]{block title}
    \usebeamerfont*{block title}\insertblocktitle%
  \end{beamercolorbox}%
  {\parskip0pt\par}%
  {\nointerlineskip\vskip-0.5pt}%
  \usebeamerfont{block body}%
  \begin{beamercolorbox}[%
    sep=.5ex,%
    dp=0.6ex,%
    leftskip=0.5ex,%
    rightskip=0.5ex,%
    vmode%
    ]{block body}%
  }
  \setbeamertemplate{block end}  
  {\end{beamercolorbox}\vskip\smallskipamount}

\setbeamertemplate{block alerted begin}
{
  \setbeamercolor{item}{parent=block body alerted}
  \par\vskip\medskipamount%
  \begin{beamercolorbox}[%
    sep=.5ex,%
    dp=0.6ex,%
    leftskip=0.5ex,%
    rightskip=0.5ex%
    ]{block title alerted}
    \usebeamerfont*{block title alerted}\insertblocktitle%
  \end{beamercolorbox}%
  {\parskip0pt\par}%
  {\nointerlineskip\vskip-0.5pt}%
  \usebeamerfont{block body alerted}%
  \begin{beamercolorbox}[%
    sep=.5ex,%
    dp=0.6ex,%
    leftskip=0.5ex,%
    rightskip=0.5ex,%
    vmode%
    ]{block body alerted}%
  }
  \setbeamertemplate{block alerted end}
  {\end{beamercolorbox}\vskip\smallskipamount}

\setbeamertemplate{block example begin}
{
  \par\vskip\medskipamount%
  \begin{beamercolorbox}[%
    sep=.5ex,%
    dp=0.6ex,%
    leftskip=0.5ex,%
    rightskip=0.5ex%
    ]{block title example}
    \usebeamerfont*{block title example}\insertblocktitle%
  \end{beamercolorbox}%
  {\parskip0pt\par}%
  {\nointerlineskip\vskip-0.5pt}%
  \usebeamerfont{block body example}%
  \begin{beamercolorbox}[%
    sep=.5ex,%
    dp=0.6ex,%
    leftskip=0.5ex,%
    rightskip=0.5ex,%
    vmode%
    ]{block body example}%
  }
  \setbeamertemplate{block example end}
  {\end{beamercolorbox}\vskip\smallskipamount}

\mode<all>
